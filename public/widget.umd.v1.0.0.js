(function(r,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.Widget={},r.Vue))})(this,(function(r,e){"use strict";const i=e.ref("");function u(){if(window.FEEDBACK_CONFIG&&window.FEEDBACK_CONFIG.projectSlug){i.value=window.FEEDBACK_CONFIG.projectSlug;return}const t=document.getElementsByTagName("script");for(const o of t)if(o.src&&o.src.includes("widget.umd")){const s=o.getAttribute("data-project-slug");if(s){i.value=s;return}}i.value=""}const f=(t,o)=>{const s=t.__vccOpts||t;for(const[l,a]of o)s[l]=a;return s},E={class:"modal-dialog modal-lg feedback-modal-dialog"},w={class:"modal-content feedback-modal-content"},g={class:"modal-body feedback-modal-body"},b={class:"mb-3"},N={class:"mb-3"},k={class:"mb-3"},y={key:0,class:"form-text text-danger"},V={class:"modal-footer feedback-modal-footer"},S=["disabled"],h=f({__name:"FeedbackModal",emits:["close"],setup(t,{emit:o}){const s=o,l=e.ref(""),a=e.ref(""),d=e.ref(""),_=e.ref(!1);e.onMounted(()=>{l.value=localStorage.getItem("name")||"",a.value=localStorage.getItem("contact")||""});const m=()=>s("close"),A=e.computed(()=>a.value&&d.value&&d.value.length>=10&&!_.value),T=async()=>{_.value=!0;try{const p={project_slug:i.value,author_name:l.value.trim()||null,author_email:a.value.trim()||null,author_login:"",description:d.value,page_url:window.location.href,user_agent:navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`,console_logs:JSON.stringify(window.__FEEDBACK_LOGS__||[]),network_errors:JSON.stringify(window.__FEEDBACK_NETWORK_ERRORS__||[]),js_errors:JSON.stringify(window.__FEEDBACK_JS_ERRORS__||[])},n=await fetch("http://localhost:8000/api/tickets/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),c=await n.json();n.ok&&c.ticket_id?(localStorage.setItem("name",l.value),localStorage.setItem("contact",a.value),m(),setTimeout(()=>{alert(`Ваша заявка №${c.ticket_id} принята! Спасибо!`)},200)):alert("Ошибка при отправке заявки. Попробуйте позже.")}catch{alert("Ошибка сети. Попробуйте позже.")}finally{_.value=!1}};return(p,n)=>(e.openBlock(),e.createElementBlock("div",{class:"feedback-modal-backdrop",onClick:e.withModifiers(m,["self"])},[e.createElementVNode("div",E,[e.createElementVNode("div",w,[e.createElementVNode("div",{class:"modal-header feedback-modal-header"},[n[3]||(n[3]=e.createElementVNode("h5",{class:"modal-title"},"Сообщить о проблеме",-1)),e.createElementVNode("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:m})]),e.createElementVNode("form",{onSubmit:e.withModifiers(T,["prevent"])},[e.createElementVNode("div",g,[e.createElementVNode("div",b,[n[4]||(n[4]=e.createElementVNode("label",{class:"form-label"},"Ваше имя",-1)),e.withDirectives(e.createElementVNode("input",{type:"text",class:"form-control","onUpdate:modelValue":n[0]||(n[0]=c=>l.value=c),autocomplete:"name"},null,512),[[e.vModelText,l.value]])]),e.createElementVNode("div",N,[n[5]||(n[5]=e.createElementVNode("label",{class:"form-label"},[e.createTextVNode("Email или телефон "),e.createElementVNode("span",{style:{color:"red"}},"*")],-1)),e.withDirectives(e.createElementVNode("input",{type:"text",class:"form-control","onUpdate:modelValue":n[1]||(n[1]=c=>a.value=c),required:""},null,512),[[e.vModelText,a.value]])]),e.createElementVNode("div",k,[n[6]||(n[6]=e.createElementVNode("label",{class:"form-label"},[e.createTextVNode("Что произошло? "),e.createElementVNode("span",{style:{color:"red"}},"*")],-1)),e.withDirectives(e.createElementVNode("textarea",{class:"form-control","onUpdate:modelValue":n[2]||(n[2]=c=>d.value=c),rows:"4",required:"",minlength:"10"},null,512),[[e.vModelText,d.value]]),d.value&&d.value.length<10?(e.openBlock(),e.createElementBlock("div",y,"Минимум 10 символов")):e.createCommentVNode("",!0)])]),e.createElementVNode("div",V,[e.createElementVNode("button",{type:"button",class:"btn btn-secondary",onClick:m},"Отмена"),e.createElementVNode("button",{type:"submit",class:"btn btn-primary",disabled:!A.value},"Отправить",8,S)])],32)])])]))}},[["__scopeId","data-v-72f54e00"]]),C=["aria-pressed"],B=f({__name:"FeedbackButton",setup(t){const o=e.ref(!1);return(s,l)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("button",{class:"feedback-btn","aria-pressed":o.value,onClick:l[0]||(l[0]=a=>o.value=!0)},[...l[2]||(l[2]=[e.createElementVNode("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e.createElementVNode("circle",{cx:"12",cy:"12",r:"12",fill:"white"}),e.createElementVNode("text",{x:"12",y:"17","text-anchor":"middle","font-size":"16",fill:"#0d6efd","font-family":"Arial","dominant-baseline":"middle"},"?")],-1)])],8,C),o.value?(e.openBlock(),e.createBlock(h,{key:0,onClose:l[1]||(l[1]=a=>o.value=!1)})):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-19f7d865"]]),x={__name:"app",setup(t){return(o,s)=>{const l=e.resolveComponent("NuxtRouteAnnouncer"),a=e.resolveComponent("NuxtWelcome");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(l),e.createVNode(a),e.createVNode(B)])}}};window.__FEEDBACK_LOGS__=[],window.__FEEDBACK_NETWORK_ERRORS__=[],window.__FEEDBACK_JS_ERRORS__=[];const O=console.error,R=console.warn;console.error=(...t)=>{window.__FEEDBACK_LOGS__.push({type:"error",time:Date.now(),data:t.map(String)}),O.apply(console,t)},console.warn=(...t)=>{window.__FEEDBACK_LOGS__.push({type:"warn",time:Date.now(),data:t.map(String)}),R.apply(console,t)},window.addEventListener("error",t=>{window.__FEEDBACK_JS_ERRORS__.push({message:t.message,file:t.filename,line:t.lineno,column:t.colno,stack:t.error?.stack||null,time:Date.now()})}),window.addEventListener("unhandledrejection",t=>{window.__FEEDBACK_JS_ERRORS__.push({type:"unhandledrejection",reason:t.reason?.message||String(t.reason),stack:t.reason?.stack||null,time:Date.now()})});const D="1.0.0";function F(t="#widget-root"){u();let o=document.querySelector(t);o||(o=document.createElement("div"),o.id=t.replace("#",""),document.body.appendChild(o)),e.createApp(x).mount(o)}r.WIDGET_VERSION=D,r.default=F,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
