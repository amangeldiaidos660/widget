(function(s,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(s=typeof globalThis<"u"?globalThis:s||self,e(s.Widget={},s.Vue))})(this,(function(s,e){"use strict";const _=e.ref("");function u(){if(window.FEEDBACK_CONFIG&&window.FEEDBACK_CONFIG.projectSlug){_.value=window.FEEDBACK_CONFIG.projectSlug;return}const t=document.getElementsByTagName("script");for(const n of t)if(n.src&&n.src.includes("widget.umd")){const r=n.getAttribute("data-project-slug");if(r){_.value=r;return}}_.value=""}const E={class:"modal-dialog modal-lg feedback-modal-dialog"},w={class:"modal-content feedback-modal-content"},g={class:"modal-body feedback-modal-body"},N={class:"mb-3"},b={class:"mb-3"},y={class:"mb-3"},h={key:0,class:"form-text text-danger"},S={class:"modal-footer feedback-modal-footer"},V=["disabled"],k={__name:"FeedbackModal",emits:["close"],setup(t,{emit:n}){const r=n,o=e.ref(""),a=e.ref(""),c=e.ref(""),f=e.ref(!1);e.onMounted(()=>{o.value=localStorage.getItem("name")||"",a.value=localStorage.getItem("contact")||""});const p=()=>r("close"),F=e.computed(()=>a.value&&c.value&&c.value.length>=10&&!f.value),T=async()=>{f.value=!0;try{const m={project_slug:_.value,author_name:o.value.trim()||null,author_email:a.value.trim()||null,author_login:"",description:c.value,page_url:window.location.href,user_agent:navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`,console_logs:JSON.stringify(window.__FEEDBACK_LOGS__||[]),network_errors:JSON.stringify(window.__FEEDBACK_NETWORK_ERRORS__||[]),js_errors:JSON.stringify(window.__FEEDBACK_JS_ERRORS__||[])};console.log("Отправляем payload:",m);const l=await fetch("https://api.neurocity.app/api/tickets/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),d=await l.text();let i;try{i=JSON.parse(d)}catch{i=d}console.log("Ответ сервера:",i),l.ok&&i.ticket_id?(localStorage.setItem("name",o.value),localStorage.setItem("contact",a.value),p(),setTimeout(()=>{alert(`Ваша заявка №${i.ticket_id} принята! Спасибо!`)},200)):alert("Ошибка при отправке заявки: "+JSON.stringify(i))}catch(m){alert("Ошибка сети. Попробуйте позже."),console.error(m)}finally{f.value=!1}};return(m,l)=>(e.openBlock(),e.createElementBlock("div",{class:"feedback-modal-backdrop",onClick:e.withModifiers(p,["self"])},[e.createElementVNode("div",E,[e.createElementVNode("div",w,[e.createElementVNode("div",{class:"modal-header feedback-modal-header"},[l[3]||(l[3]=e.createElementVNode("h5",{class:"modal-title"},"Сообщить о проблеме",-1)),e.createElementVNode("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:p})]),e.createElementVNode("form",{onSubmit:e.withModifiers(T,["prevent"])},[e.createElementVNode("div",g,[e.createElementVNode("div",N,[l[4]||(l[4]=e.createElementVNode("label",{class:"form-label"},"Ваше имя",-1)),e.withDirectives(e.createElementVNode("input",{type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=d=>o.value=d),autocomplete:"name"},null,512),[[e.vModelText,o.value]])]),e.createElementVNode("div",b,[l[5]||(l[5]=e.createElementVNode("label",{class:"form-label"},[e.createTextVNode("Email или телефон "),e.createElementVNode("span",{style:{color:"red"}},"*")],-1)),e.withDirectives(e.createElementVNode("input",{type:"text",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=d=>a.value=d),required:""},null,512),[[e.vModelText,a.value]])]),e.createElementVNode("div",y,[l[6]||(l[6]=e.createElementVNode("label",{class:"form-label"},[e.createTextVNode("Что произошло? "),e.createElementVNode("span",{style:{color:"red"}},"*")],-1)),e.withDirectives(e.createElementVNode("textarea",{class:"form-control","onUpdate:modelValue":l[2]||(l[2]=d=>c.value=d),rows:"4",required:"",minlength:"10"},null,512),[[e.vModelText,c.value]]),c.value&&c.value.length<10?(e.openBlock(),e.createElementBlock("div",h,"Минимум 10 символов")):e.createCommentVNode("",!0)])]),e.createElementVNode("div",S,[e.createElementVNode("button",{type:"button",class:"btn btn-secondary",onClick:p},"Отмена"),e.createElementVNode("button",{type:"submit",class:"btn btn-primary",disabled:!F.value},"Отправить",8,V)])],32)])])]))}},C=["aria-pressed"],x={__name:"FeedbackButton",setup(t){const n=e.ref(!1);return(r,o)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("button",{class:"feedback-btn","aria-pressed":n.value,onClick:o[0]||(o[0]=a=>n.value=!0),title:"Обратная связь"},[...o[2]||(o[2]=[e.createElementVNode("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e.createElementVNode("circle",{cx:"16",cy:"16",r:"15",fill:"#fff",stroke:"#0d6efd","stroke-width":"2"}),e.createElementVNode("text",{x:"16",y:"21","text-anchor":"middle","font-size":"20",fill:"#0d6efd","font-family":"Arial","dominant-baseline":"middle","font-weight":"bold"},"?")],-1)])],8,C),e.createVNode(e.Transition,{name:"fade-modal"},{default:e.withCtx(()=>[n.value?(e.openBlock(),e.createBlock(k,{key:0,onClose:o[1]||(o[1]=a=>n.value=!1)})):e.createCommentVNode("",!0)]),_:1})]))}},B={__name:"app",setup(t){return(n,r)=>{const o=e.resolveComponent("NuxtRouteAnnouncer"),a=e.resolveComponent("NuxtWelcome");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(o),e.createVNode(a),e.createVNode(x)])}}};window.__FEEDBACK_LOGS__=[],window.__FEEDBACK_NETWORK_ERRORS__=[],window.__FEEDBACK_JS_ERRORS__=[];const O=console.error,R=console.warn;console.error=(...t)=>{window.__FEEDBACK_LOGS__.push({type:"error",time:Date.now(),data:t.map(String)}),O.apply(console,t)},console.warn=(...t)=>{window.__FEEDBACK_LOGS__.push({type:"warn",time:Date.now(),data:t.map(String)}),R.apply(console,t)},window.addEventListener("error",t=>{window.__FEEDBACK_JS_ERRORS__.push({message:t.message,file:t.filename,line:t.lineno,column:t.colno,stack:t.error?.stack||null,time:Date.now()})}),window.addEventListener("unhandledrejection",t=>{window.__FEEDBACK_JS_ERRORS__.push({type:"unhandledrejection",reason:t.reason?.message||String(t.reason),stack:t.reason?.stack||null,time:Date.now()})});const D="1.0.0";function A(t="#widget-root"){(function(){var r="widget-feedback-css";if(!document.getElementById(r)){var o=document.createElement("link");o.id=r,o.rel="stylesheet",o.type="text/css",o.href="./widget-feedback.css",document.head.appendChild(o)}})(),u();let n=document.querySelector(t);n||(n=document.createElement("div"),n.id=t.replace("#",""),document.body.appendChild(n)),e.createApp(B).mount(n)}s.WIDGET_VERSION=D,s.default=A,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
